<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>צור קשר | בא״פ לכיש</title>
    <link rel="icon" href="favicon/favicon.png" type="image/png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="contact.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<header>
    <div class="container">
        <div class="header-content">
            <a href="index.html"><img src="images/image.png" alt="Logo"></a>
            <h1>בא״פ לכיש</h1>
            <button class="menu-btn" aria-label="Toggle Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </div>
</header>

<nav class="nav-menu">
    <a href="index.html">
        <i class="fas fa-home"></i> דף הבית
    </a>
    <a href="lehima.html">
        <i class="fas fa-shield-alt"></i> ביה״ס ללחימה
    </a>
    <a href="hagnash.html">
        <i class="fas fa-hard-hat"></i> ביה״ס להגנ״ש
    </a>
    <a href="nehiga.html">
        <i class="fas fa-car"></i> ביה״ס לנהיגה
    </a>
    <a href="gashashim.html">
        <i class="fas fa-search"></i> ביה״ס לגששים
    </a>
    <a href="https://safetyprod.azurewebsites.net">
        <i class="fas fa-exclamation-triangle"></i> בטיחות
    </a>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSczMrVOz_pTev4FcaAcLqKwGiQUHYSj-b916dhsPt8fOx9gyw/viewform">
        <i class="fas fa-tasks"></i> תיאום אימון עצמאי
    </a>
    <a href="hadracha.html">
        <i class="fas fa-book"></i> הדרכה
    </a>
    <a href="contact.html" class="active">
        <i class="fas fa-address-book"></i> צור קשר
    </a>
</nav>

<section class="page-hero">
    <div class="page-hero-content">
        <div class="hero-icon">
            <i class="fas fa-address-book"></i>
        </div>
        <h2>צור קשר</h2>
        <p>אנשי קשר מרכזיים בבא״פ לכיש</p>
    </div>
</section>

<div class="contact-grid" id="contactGrid">
    <!-- Contact cards will be dynamically generated by JavaScript -->
    <div class="loading-message">
        <p>טוען אנשי קשר...</p>
    </div>
</div>

<script>
    // Fetch and display contacts from CSV
    async function fetchContacts() {
        try {
            // URL for the published CSV (note: Google Sheets needs to be published to the web as CSV)
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSviLg-2HGy1xh6OUm6DUBL8rdFssGlowoYRIB4KjTpi21dlPCQ8RINGsuTZ1KbXxeiNW5zA64fIICn/pub?output=csv'; // Replace with your actual CSV URL

            const response = await fetch(csvUrl);
            if (!response.ok) {
                throw new Error('Failed to fetch data');
            }

            const csvData = await response.text();
            const contacts = parseCSV(csvData);
            displayContacts(contacts);
        } catch (error) {
            console.error('Error fetching contacts:', error);
            document.getElementById('contactGrid').innerHTML = `
                <div class="error-message">
                    <p>לא ניתן לטעון את אנשי הקשר כרגע. נסה שוב מאוחר יותר.</p>
                </div>
            `;
        }
    }

    // Parse CSV data
    function parseCSV(csvText) {
        const lines = csvText.split('\n');
        const headers = lines[0].split(',').map(header => header.trim());

        const contacts = [];

        for (let i = 1; i < lines.length; i++) {
            if (!lines[i].trim()) continue;

            // Handle commas within quoted fields
            const values = [];
            let inQuotes = false;
            let currentValue = '';

            for (let j = 0; j < lines[i].length; j++) {
                const char = lines[i][j];

                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(currentValue.trim());
                    currentValue = '';
                } else {
                    currentValue += char;
                }
            }

            values.push(currentValue.trim());

            const contact = {};
            headers.forEach((header, index) => {
                contact[header] = values[index] || '';
            });

            contacts.push(contact);
        }

        return contacts;
    }

    // Format phone number for display (convert to Israeli format: 052-3328127)
    function formatPhoneNumber(phoneNumber) {
        // Clean the phone number (but keep the + sign if it exists)
        let cleaned = phoneNumber.replace(/[^\d+]/g, '');

        // Handle international format with +972 (Israeli numbers)
        if (cleaned.startsWith('+972')) {
            // Extract the part after +972 and add 0 at the beginning
            const localPart = cleaned.substring(4);
            return '0' + localPart.substring(0, 2) + '-' + localPart.substring(2);
        }

        // Handle local format that starts with 0
        if (cleaned.startsWith('0') && cleaned.length === 10) {
            return cleaned.substring(0, 3) + '-' + cleaned.substring(3);
        }

        // If the number doesn't fit any pattern, return as is
        return phoneNumber;
    }

    // Prepare phone number for tel: link (ensure it's in international format for dialing)
    function prepareTelLink(phoneNumber) {
        // Clean the phone number (but keep the + sign if it exists)
        let cleaned = phoneNumber.replace(/[^\d+]/g, '');

        // If it's in international format (+972...), keep it as is
        if (cleaned.startsWith('+')) {
            return cleaned;
        }

        // If it's in local format (05...), convert to international format
        if (cleaned.startsWith('0') && cleaned.length === 10) {
            return '+972' + cleaned.substring(1);
        }

        // If we can't determine the format, keep as is
        return phoneNumber;
    }

    // Display contacts in the grid
    function displayContacts(contacts) {
        const contactGrid = document.getElementById('contactGrid');
        contactGrid.innerHTML = '';

        contacts.forEach(contact => {
            if (!contact['name'] || !contact['job']) return;

            // Determine the appropriate icon based on the role or department
            let iconClass = 'fas fa-user';
            const role = contact['job'].toLowerCase();

            if (role.includes('נהיגה')) {
                iconClass = 'fas fa-car';
            } else if (role.includes('לחימה')) {
                iconClass = 'fas fa-crosshairs';
            } else if (role.includes('הגנ״ש') || role.includes('הגנש')) {
                iconClass = 'fas fa-shield';
            } else if (role.includes('גששים')) {
                iconClass = 'fas fa-search';
            } else if (role.includes('אג״ם') || role.includes('אגם')) {
                iconClass = 'fas fa-sitemap';
            } else if (role.includes('לוגיסטיקה')) {
                iconClass = 'fas fa-truck';
            } else if (role.includes('שטחי אש')) {
                iconClass = 'fas fa-map-marked-alt';
            } else if (role.includes('הדרכה') || role.includes('קה״ד')) {
                iconClass = 'fas fa-user-graduate';
            } else if (role.includes('מפקד') || role.includes('סגן מפקד')) {
                iconClass = 'fas fa-user-tie';
            }

            const phoneNumber = contact['number']?.replace(/[^\d+]/g, '') || '';
            const formattedPhone = phoneNumber ? formatPhoneNumber(phoneNumber) : '';
            const telLink = phoneNumber ? prepareTelLink(phoneNumber) : '';

            const cardHTML = `
                <div class="contact-card">
                    <div class="contact-header">
                        <div class="contact-icon">
                            <i class="${iconClass}"></i>
                        </div>
                        <div class="contact-title">
                            <h3>${contact['name']}</h3>
                            <p>${contact['job']}</p>
                        </div>
                    </div>
                    <div class="contact-details">
                        ${phoneNumber ? `
                            <div class="contact-info">
                                <i class="fas fa-phone"></i>
                                <div class="contact-text">
                                    <strong>טלפון</strong>
                                    <span><a href="tel:${telLink}">${formattedPhone}</a></span>
                                </div>
                            </div>
                        ` : ''}
                        ${contact['email'] ? `
                            <div class="contact-info">
                                <i class="fas fa-envelope"></i>
                                <div class="contact-text">
                                    <strong>אימייל</strong>
                                    <span><a href="mailto:${contact['email']}">${contact['email']}</a></span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            contactGrid.innerHTML += cardHTML;
        });
    }

    // Load contacts when the page loads
    document.addEventListener('DOMContentLoaded', fetchContacts);

    // Menu functionality
    const menuBtn = document.querySelector('.menu-btn');
    const navMenu = document.querySelector('.nav-menu');

    // Hide menu by default
    navMenu.style.display = 'none';

    menuBtn.addEventListener('click', () => {
        menuBtn.classList.toggle('active');
        if (navMenu.style.display === 'none') {
            navMenu.style.display = 'flex';
        } else {
            navMenu.style.display = 'none';
        }
    });

    // Add hover effect to nav items
    const navLinks = document.querySelectorAll('.nav-menu a');
    navLinks.forEach(link => {
        link.addEventListener('mouseenter', () => {
            navLinks.forEach(otherLink => {
                if (otherLink !== link) {
                    otherLink.style.opacity = '0.5';
                }
            });
        });

        link.addEventListener('mouseleave', () => {
            navLinks.forEach(otherLink => {
                otherLink.style.opacity = '1';
            });
        });
    });
</script>

<div class="footer-container">
    <div class="footer-content">
        <div class="footer-text">© 2024 בא״פ לכיש - כל הזכויות שמורות</div>
    </div>
</div>
</body>
</html>